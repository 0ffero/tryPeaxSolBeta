"use strict";let AI=class{constructor(e,t,a){this.errors=[],this.alive=!1,this.scoreData=a,this.deck=e,this.aiDeck=[...e.split(",")];let n=this.aiDeck.splice(0,29);return(this.aiDeck.reverse(),this.aiDeck=[...n,...this.aiDeck],this.solution=t,this.fingerMoveDuration=500,this.getDeckReadyForInit(),this.getSolutionReadyForInit(),this.errors.length)?(this.showErrorPopUp(),!1):void(this.init(),this.alive=!0)}init(){this.finger=scene.add.image(consts.canvas.cX+30,.9*consts.canvas.height,"ui","aiFingerMoving").setDepth(consts.depths.aiFinger).setAlpha(0).setData({container:null,card:null}),scene.tweens.add({targets:this.finger,alpha:1,duration:this.fingerMoveDuration}),this.containerOffsets={cardsDealt:{},cardsLeft:{}}}buildDeckAndDeal(){let e=vars.game;e.deck=new Deck,e.deck.cardSet=this.deckForDeckClass,e.deal=new Deal(e.deck),e.deal.solution=this.solution,this.waitForDeal()}generateScorePopUp(){let e=scene.children.getByName("game_fg");scene.tweens.add({targets:e,alpha:.5,duration:250});let t=consts.depths.aiPopUp,a=this.scoreData.name,n=this.scoreData.score,i=this.scoreData.time,s=consts.canvas,o=scene.add.bitmapText(s.cX,.6*s.height,"defaultFont",`Well done ${a}\nYour final score was ${n}\nWith a time of ${i}`,78,1).setDropShadow(8,8).setName("AIPopUPScoreAndTime").setTint(consts.tints.orange).setOrigin(.5).setDepth(t).setAlpha(0);scene.tweens.add({targets:o,alpha:1,y:.4*s.height,duration:500,hold:3e3,yoyo:!0,onComplete:(e,t)=>{t[0].destroy()}})}getDeckReadyForInit(){this.deck=this.deck.split(","),52!==this.deck.length&&this.errors.push(`The deck was invalid. The deck has ${this.deck.length} cards in it!`),this.deckForDeckClass=[],this.deck.forEach(e=>{let t=e.slice(-1);e=e.replace(t,`_${t}`),this.deckForDeckClass.push(e)})}getSolutionReadyForInit(){let e=this.solution.split(",");for(this.solution=[];e.length;){let t=e.shift(),a=e.shift();a=parseInt(a,consts.timeRadix),this.solution.push([t,a])}(28>this.solution.length||52<this.solution.length)&&this.errors.push(`The solution was invalid. The solution has ${e.length} moves in it!`)}getUIReady(){vars.DEBUG?console.log(`Getting the UI Ready!`):null,this.hideTheContainers(),this.buildDeckAndDeal(),vars.UI.showGameplayUI(!1,0,"ai")}hideTheContainers(e=!0){let t=vars.containers,a=!e;t.show("highScoreTable",a),t.show("mainScreen",a),vars.UI.showForegroundBarrier(a),vars.game.newGameUIResets()}playNextMove(){if(vars.DEBUG?console.log(`AI: Getting next move!`):null,!this.solution.length)return this.destroy(),!0;let e=this.solution.shift(),t=~~e[0],a=~~e[1],n=29<t?"cardsLeft":"cardsDealt",i=this.containerOffsets[n],s=this.aiDeck[t-1],o=`card_${s}`;this.finger.setData({container:n,card:o,time:a});let d=vars.containers.getByName(n).getByName(o),r={x:d.x+i.x+30,y:d.y+i.y+30};scene.tweens.add({targets:this.finger,x:r.x,y:r.y,duration:this.fingerMoveDuration,delay:this.fingerMoveDuration,onComplete:(e,t)=>{vars.DEBUG?console.log(`Clicking on the card`):null,t[0].setFrame("aiFingerClicking"),vars.audio.playSound("cardLeftTurn");let a=t[0].getData("time");vars.AI.current.updateTimer(a);let n=t[0].getData("container"),i=t[0].getData("card"),s=vars.containers.getByName(n).getByName(i);vars.game.deal.clickOnCard(s),scene.tweens.add({targets:vars.AI.current.finger,scale:.8,duration:125,yoyo:!0,onComplete:(e,t)=>{t[0].setFrame("aiFingerMoving")}}),vars.DEBUG?console.log(`Waiting 500ms then Re-requesting playNextMove`):null,scene.tweens.addCounter({from:0,to:1,duration:500,onComplete:vars.AI.requestNextMove})}})}showErrorPopUp(){let e=consts.canvas,t=consts.depths.highScoreTable+5,a=scene.add.bitmapText(e.cX,.6*e.height,"defaultFont","The solution or deck is invalid!\nUnable to replay game.",72,1).setOrigin(.5).setAlpha(0).setDepth(t).setScale(.75);scene.tweens.add({targets:a,scale:1,y:e.cY,alpha:1,duration:1e3,hold:2e3,yoyo:!0,onComplete:(e,t)=>{t[0].destroy()}})}solve(){vars.DEBUG?console.log(`Doing solve!`):null,this.playNextMove()}updateTimer(e){return vars.UI.updateTimer(~~(e/100)/10),!0}waitForDeal(){if(vars.game.deal.allCardsDealt){let e=vars.AI.current;["cardsDealt","cardsLeft"].forEach(t=>{let a=vars.containers.getByName(t);e.containerOffsets[t]={x:a.x,y:a.y}}),vars.AI.disableInteractiveOnAllCards(),e.solve()}else scene.tweens.addCounter({from:0,to:1,duration:500,onComplete:vars.AI.current.waitForDeal})}destroy(){let e=this.scoreData.score,t=this.scoreData.time,a=vars.containers.getByName("gamePlayingUI");a.getByName("scoreText").setText(`${e} - SCORE`),a.getByName("timerText").setText(`${t}s - TIME`),scene.tweens.add({targets:this.finger,alpha:0,delay:1e3,duration:2e3,onComplete:(e,t)=>{t[0].destroy(),vars.AI.current.generateScorePopUp(),scene.tweens.addCounter({from:0,to:1,duration:4e3,onComplete:()=>{vars.containers.cardsDestroyAll(),vars.UI.showGameplayUI(!0),vars.AI.current.hideTheContainers(!1),this.alive=!1,vars.AI.destroy()}})}})}};let Deal=class{constructor(e){this.deck=e.cardSet,this.deckCache=[],this.deck.forEach(e=>{this.deckCache.push(e.replace("_",""))}),this.deckCache=this.deckCache.join(","),this.penaliseErrors=vars.game.penaliseErrors,this.rows=[[1,2,3],[4,5,6,7,8,9],[10,11,12,13,14,15,16,17,18],[19,20,21,22,23,24,25,26,27,28]],this.cardEnables={1:[4,5],2:[6,7],3:[8,9],4:[10,11],5:[11,12],6:[13,14],7:[14,15],8:[16,17],9:[17,18],10:[19,20],11:[20,21],12:[21,22],13:[22,23],14:[23,24],15:[24,25],16:[25,26],17:[26,27],18:[27,28]},this.cardValue={A:1,J:11,Q:12,K:13},this.currentDepth=4,this.lastRemainingCard=!1,this.allCardsDealt=!1,this.solution=[],this.dealCards(),this.bestStreak=0,this.cardsMoved=0,this.currentTime=0,this.startTime=null,vars.UI.updateTimer(0),this.win=!1,this.winDelay=0,this.winDelayInc=125}dealCards(){this.dealRows(),this.dealCurrentCard(),this.dealRemainingCards()}dealCurrentCard(){let e=scene.groups.cardCurrent,t=this.deck.shift(),a=t.split("_"),n=a[0],i=a[1],s=t.replace("_",""),o=this.getCardInt(n),d=consts.canvas.cX,r=consts.layout.gameArea.lowestSetY,l=scene.physics.add.image(d,r,"cards",s).setName(`card_${s}`).setData({value:n,cardInt:o,suit:i,position:29,faceUp:!0,row:0}).setDepth(this.currentDepth).setAlpha(0);e.add(l),this.showCard(l,29),this.currentCardPosition=[d,r],this.currentCardValue=o}dealRemainingCards(){let e=scene.groups.cardsLeft,t=205;e.setPosition(t,0);let a=consts.layout.gameArea.lowestSetY,n=60,i=30;for(this.deck.reverse();0<this.deck.length;){let s=this.deck.shift(),o=s.split("_"),d=o[0],r=o[1],l=s.replace("_",""),c=this.getCardInt(d),u=scene.physics.add.image(n,a,"cards","00").setName(`card_${l}`).setData({value:d,cardInt:c,suit:r,position:i,faceUp:!1,row:5,rIndex:i-30,cOffset:[t,0]}).setAlpha(0);this.deck.length?null:u.setInteractive(),e.add(u),this.showCard(u,i),n+=15,i++}}dealRows(){let e=consts.layout,t=scene.groups.cardsDealt,a=consts.layout.gameArea,n=a.padding,i=n.x,s=n.y,o=[consts.canvas.cX-i,a.lowestSetY],d=e.card.height/2,r=e.card.width,l=r/2,c=0,u=e.gameArea.peak,g=0,h=u[g],p=1;this.rows.forEach((e,a)=>{0===a?e.forEach((e,n)=>{let d=this.deck.shift(),r=d.split("_"),l=r[0],g=r[1],m=d.replace("_",""),f=this.getCardInt(l);h=u[n];let S=scene.physics.add.image(o[0],o[1],"cards","00").setName(`card_${m}`).setData({value:l,cardInt:f,suit:g,position:e,faceUp:!1,row:4-a,cOffset:[i,s],pos:[h,c]}).setAlpha(p);t.add(S),this.showCard(S,e)}):1===a?e.forEach((e,n)=>{n&&0==n%2&&g++,h=0==n%2?u[g]-l-5:u[g]+l+5;let d=this.deck.shift(),r=d.split("_"),m=r[0],f=r[1],S=d.replace("_",""),D=this.getCardInt(m),k=scene.physics.add.image(o[0],o[1],"cards","00").setName(`card_${S}`).setData({value:m,cardInt:D,suit:f,position:e,faceUp:!1,row:4-a,cOffset:[i,s],pos:[h,c]}).setAlpha(p);t.add(k),this.showCard(k,e)}):2===a?(g=0,h=u[g],e.forEach((e,n)=>{n&&0==n%3&&g++,h=0==n%3?u[g]-r-5:1==n%3?u[g]:u[g]+r+5;let d=this.deck.shift(),l=d.split("_"),m=l[0],f=l[1],S=d.replace("_",""),D=this.getCardInt(m),k=scene.physics.add.image(o[0],o[1],"cards","00").setName(`card_${S}`).setData({value:m,cardInt:D,suit:f,position:e,faceUp:!1,row:4-a,cOffset:[i,s],pos:[h,c]}).setAlpha(p);t.add(k),this.showCard(k,e)})):3===a?(h=u[0]-1.5*(r+5),e.forEach(e=>{let n=this.deck.shift(),d=n.split("_"),l=d[0],u=d[1],g=n.replace("_",""),m=this.getCardInt(l),f=scene.physics.add.image(o[0],o[1],"cards",g).setName(`card_${g}`).setData({value:l,cardInt:m,suit:u,position:e,faceUp:!0,row:4-a,cOffset:[i,s],pos:[h,c]}).setAlpha(p).setInteractive();t.add(f),this.showCard(f,e),h+=r+5})):void 0;c+=d})}afterLastCardDealt(){vars.UI.showGameplayUI(!0)}checkDealtCard(e){let t=~~e.getData("cardInt"),a=this.getLowHigh(),n=a[0],i=a[1],s=vars.game.deck;if(t===n)this.currentCardValue=n;else if(t===i)this.currentCardValue=i;else return this.shakeInvalidCard(e),this.penaliseErrors&&(s.resetStreak(),s.decreaseScore()),!1;this.updateCardsMoved(),e.disableInteractive(),scene.groups.cardsDealt.remove(e);let o=consts.layout.gameArea.padding,d=e.x+o.x,r=e.y+o.y;e.setPosition(d,r),this.currentDepth++,e.setDepth(this.currentDepth),scene.groups.cardCurrent.add(e);let l=Phaser.Math.Distance.Between(e.x,e.y,this.currentCardPosition[0],this.currentCardPosition[1])/2;scene.tweens.add({targets:e,x:this.currentCardPosition[0],y:this.currentCardPosition[1],duration:l});let c=~~e.getData("position");this.updateSolution(c),s.increaseScore(d,r);let u=!1;for(let t in this.cardEnables){let e=this.cardEnables[t];e.includes(c)&&(e.forEach((e,t)=>{e===c&&(u=t)}),this.cardEnables[t].splice(u,1),0===this.cardEnables[t].length&&this.unhideCard(~~t))}return this.checkUpperRowForBonus(c)&&s.increaseScore(null,null,500),scene.groups.cardsDealt.length?this.checkIfAnyMoreMovesAreAvailable()?void 0:(this.gameWinLose(!1),!1):(this.gameWinLose(!0),!0)}checkIfAnyMoreMovesAreAvailable(){if(!scene.groups.cardsLeft.list.length){let e=this.getLowHigh(),t=e[0],a=e[1],n=[];return scene.groups.cardsDealt.getAll().forEach(e=>{e.getData("faceUp")&&(e.getData("cardInt")===t||e.getData("cardInt")===a)&&n.push(e.name)}),!!n.length}return!0}checkUpperRowForBonus(e){return!![1,2,3].includes(e)&&(vars.anims.animate500(),!0)}clickOnCard(e){this.startTime||(this.startTime=new Date);let t=e.getData("row");if(!t)return!1;if(5===t)return this.showNextRemainingCard(e),this.updateCardsMoved(),!0;this.checkDealtCard(e)}dupeCard(e){let t=e.frame.name,a=22-e.getData("rIndex")+50,n=e.getData("cOffset"),i=n[0],s=n[1],o=scene.physics.add.image(e.x+i,e.y+s,"cards",t).setDepth(a).setData();return o.setInteractive().setName(e.name),o.data=e.data,e.disableInteractive().setDepth(-1).setAlpha(0),o}enableNextRemainingCard(e){if(this.lastRemainingCard)return!1;let t=e-1;0==t&&(this.lastRemainingCard=!0);let a=scene.groups.cardsLeft.getAt(t);a.setInteractive();let n=scene.groups.cardsLeft.getAll();n.forEach(e=>{scene.tweens.add({targets:e,x:"+=15",duration:framesToMs(2)})})}getLowHigh(){let e=this.currentCardValue,t=0<e-1?e-1:13,a=14>e+1?e+1:1;return[t,a]}gameLose(){vars.DEBUG?console.log(`No moves available to player.\nLet them know\nGive them options to new deal etc`):null,scene.tweens.addCounter({from:0,to:1,duration:1e3,onComplete:()=>{vars.UI.newMessage(`LOOKS LIKE YOU'RE\nALL OUT OF PLAYS...`,null,null,3e3,1e3,82,consts.tints.orange),this.startTime=null,scene.tweens.addCounter({from:0,to:1,duration:5e3,onComplete:()=>{vars.game.deck.lose()}})}})}gameWin(){vars.DEBUG?console.log(`%c^^ WIN! ^^`,"font-weight: bold; font-size: 16px; color: #00FF00"):null,vars.game.deck.win()}gameWinLose(e=!0){if(vars.AI.current)return!1;e?(this.win=!0,vars.game.playerStats.gamesWon++,this.gameWin()):(vars.game.playerStats.gamesLost++,this.gameLose());this.saveSolution(e),this.updatePlayerStats(),vars.UI.showGameplayUI(!1,.1,"winLose")}getCardInt(e=0){if(!e)return!1;let t=0;return t="AJQK".includes(e)?this.cardValue[e]:~~e,t}moveToPile(e,t=!1){scene.groups.cardCurrent.add(e),e.disableInteractive();let a=0;t&&!this.win?this.win=!0:null,this.win?a=this.winDelay+=this.winDelayInc:null,scene.tweens.add({targets:e,x:this.currentCardPosition[0],y:this.currentCardPosition[1],delay:a,duration:250,onStart:()=>{t?vars.game.deck.increaseScore(this.currentCardPosition[0],this.currentCardPosition[0]):null,vars.game.deck.resetStreak()}})}saveSolution(e=!1){let t=[],a=this.solution.join(","),n=this.deckCache;t.push(e,n,a);let i=vars.localStorage.saveSolution(t);return vars.game.scoreCard.solutionID=i,!0}shakeInvalidCard(e){let t=e;t.disableInteractive(),t.x-=10,scene.tweens.add({targets:t,x:t.x+10,duration:framesToMs(2),yoyo:!0,repeat:3,onComplete:(e,a)=>{a[0].x+=10,t.setInteractive()}})}showCard(e,t){let a=e.getData("pos");scene.groups.cardsDealt.sendToBack(e),e.setDepth(3).setAlpha(0);let n=500;a||(a=[e.x,e.y],n=100);e.data.list.position;scene.tweens.add({targets:e,x:a[0],y:a[1],alpha:1,delay:66*(t-1),duration:n,onStart:()=>{scene.groups.cardsDealt.bringToTop(e)},onComplete:(t,a)=>{e.setDepth(0),scene.sound.play(getRandom(vars.audio.available.newCard)),52===a[0].data.list.position&&(this.allCardsDealt=!0)}})}showNextRemainingCard(e,t=!1){let a=e,n=a.name.replace("card_","");a.setFrame(n).setData("faceUp",!0),this.currentCardValue=~~a.getData("cardInt");let i=a.getData("position");if(t?null:vars.audio.playSound("cardLeftTurn"),scene.groups.cardsLeft.remove(a),a.setPosition(a.x+205,a.y),this.currentDepth++,a.setDepth(this.currentDepth),this.moveToPile(a,t),!t){this.updateSolution(i);let t=e.getData("rIndex");if(this.enableNextRemainingCard(t),vars.game.deck.resetStreak(),!this.checkIfAnyMoreMovesAreAvailable())return this.gameWinLose(!1),!1}}unhideCard(e){let t=null;scene.groups.cardsDealt.list.forEach(a=>{t||a.getData("position")!==e||(t=a)});let a=t.name.replace("card_","");t.setFrame(a).setData("faceUp",!0).setInteractive()}update(){this.updateTimer()}updateCardsMoved(){return!vars.AI.current&&void(this.cardsMoved++,vars.game.playerStats.cardsMoved++)}updatePlayerStats(){if(!this.startTime)return!1;vars.DEBUG?console.log(`Updating player stats`):null;let e=vars.game,t=e.playerStats,a=~~((new Date-this.startTime)/100)/10;if(this.startTime=null,vars.game.scoreCard.time=a,t.totalTimePlaying=~~(100*(t.totalTimePlaying+a))/100,t.gamesPlayed++,this.bestStreak>t.bestStreak?t.bestStreak=this.bestStreak:null,t.averageCompletionTime=~~(1e3*(t.totalTimePlaying/t.gamesPlayed))/1e3,(!vars.checkType(t.averageCompletionTime,"number")||0>=t.averageCompletionTime)&&(console.error(`Problem with the new average`),vars.DEBUG)){console.log(t);debugger}vars.localStorage.savePlayerStats()}updateSolution(e){if(vars.AI.current)return!1;let t=new Date-this.startTime;t=t.toString(consts.timeRadix),this.solution.push([e,t])}updateTimer(){if(vars.AI.current)return!1;if(!this.startTime)return!1;let e=~~((new Date-this.startTime)/100)/10;this.currentTime=e,vars.UI.updateTimer(e)}};let Deck=class{constructor(){vars.DEBUG?console.log(`Class: Deck`):null,this.cardSet=[],this.init(),this.playerScore=0,this.currentStreak=0,this.realStreak=0}init(){let e=["A",2,3,4,5,6,7,8,9,10,"J","Q","K"];if(["S","C","H","D"].forEach(t=>{e.forEach(e=>{this.cardSet.push(`${e}_${t}`)})}),vars.DEBUG&&vars.debug&&vars.debug.stackedDeck)return!0;let a=getRandom(30,70);for(let e=0;e<a;e++)shuffle(this.cardSet)}decreaseScore(){100<=this.playerScore?this.playerScore-=100:this.playerScore=0}increaseScore(e,t,a=!1){let n=0;a?n=a:(this.increaseStreak(),n=100*this.currentStreak,vars.UI.newMessage(n,e,t-120,0,2e3,24,65280)),this.playerScore+=n,vars.UI.updateScore(this.playerScore)}increaseStreak(){10>this.currentStreak?this.currentStreak++:null,this.realStreak++;let e=vars.particles;1===this.currentStreak&&e.multiplierHighlightStart(!0);e.multiplierHighlightChangeColour(),scene.groups.cardsDealt.length?vars.audio.playSound(`collectCard${this.currentStreak}`):null,vars.UI.updateMultiplier(this.currentStreak),this.realStreak>vars.game.deal.bestStreak?vars.game.deal.bestStreak=this.realStreak:null}lose(){let e=this.playerScore,t=this.currentTime;vars.game.getUnlockPoints(e,t)}resetStreak(){this.currentStreak=0,this.realStreak=0,vars.UI.updateMultiplier(this.currentStreak),vars.particles.multiplierHighlightStart(!1)}win(){scene.groups.cardCurrent.setDepth(4),this.resetStreak();let e=scene.groups.cardsLeft.getAll(),t=e.length;e.forEach(e=>{vars.game.deal.showNextRemainingCard(e,!0)});scene.tweens.addCounter({from:0,to:1,duration:250*t,onComplete:()=>{let e=this.playerScore,t=vars.game.deal.currentTime;vars.game.getUnlockPoints(e,t)}})}};let LoadingBar=class{constructor(e){return!("object"!=typeof e)&&void(this.fileList=e,this.bytesLoaded=0,this.initialised=!1,this.percentOfTotal=0,this.destroyed=!1,this.ignoreFiles=["assets/scoreCard/","Loader/"],this.generateTotals())}initUI(){let e=consts.canvas;this.loadingBarBG=scene.add.image(e.cX,.77*e.height,"loadingBar","loadingBarBG"),this.loadingBar=scene.add.image(e.cX,.77*e.height,"loadingBar","loadingBarFG").setName("loadingBar"),this.initialised=!0,this.cropBar()}cropBar(){this.loadingBar.setScale(this.percentOfTotal,1),1===this.percentOfTotal&&(vars.DEBUG?console.log(`Loaded all files successfully. Destroying loading bar. Remember to null vars.loader`):null,this.destroy())}destroy(){return!this.destroyed&&(scene.tweens.add({targets:[this.loadingBar,this.loadingBarBG],alpha:0,duration:500,delay:100,onComplete:()=>{this.loadingBar.destroy(),this.loadingBarBG.destroy()}}),this.destroyed=!0,!0)}generateTotals(){this.totals={fileCount:0,bytes:0},this.filesLoaded={};let e=this.fileList;for(let t in this.totalSize=e.details.totalSize,e.files){let a=e.files[t];this.filesLoaded[t]={loaded:!1,bytes:a}}}updateBar(e){this.initialised?null:this.initUI();let t=e.url.split("/"),a=t[t.length-1];if(this.ignoreFiles.includes(a))return!1;let n=this.filesLoaded[a];if(!n)return vars.DEBUG?console.log(`%cLoaded ${a} isnt in JSON file. Its probably part of a classes requirements`,"color: orange; font-weight: bold"):null,!1;this.bytesLoaded+=n.bytes,n.loaded=!0,this.percentOfTotal=this.bytesLoaded/this.totalSize,this.cropBar()}};let ScoreCard=class{constructor(e){return e?void(this.score=null,this.time=null,this.solutionID=null,this.scene=e,this.defaultAssetsFolder="assets",this.folder="scoreCard",this.scores=vars.localStorage.scores,this.containerNames=[],this.loadRequiredFiles()):(console.error(`You must pass in the scene that the score card will sit on`),!1)}loadRequiredFiles(){this.scene.load.setPath(this.defaultAssetsFolder);let e=0,t=this.scene.textures.getTextureKeys();["whitePixel.png","scoreCardHiLight.png"].forEach(a=>{let n=a.replace(/\.png|\.jpg/g,"");t.includes(n)||(this.scene.load.image(n,`${this.folder}/${a}`),e++)}),this.scene.cache.bitmapFont.exists("scoreCard")||(this.scene.load.bitmapFont("scoreCard",`${"scoreCard"}/scoreCard.png`,`${"scoreCard"}/scoreCard.xml`),e++);0<e&&(this.scene.load.once("complete",()=>{this.filesLoaded()}),this.scene.load.start())}filesLoaded(){vars.DEBUG?console.log(`Setting up the score card`):null,this.init()}init(){this.initNameEntry(),this.initHighScoreTable()}initHighScoreTable(){this.defaultSortBy="score";let e=consts.canvas,t=consts.depths.highScoreTable;this.highScoreTableContainer=this.scene.add.container().setName("highScoreTableContainer").setDepth(t),this.containerNames.push(["highScoreTable","highScoreTableBG"]),this.scene.containers.highScoreTable=this.highScoreTableContainer;let a=this.scene.add.image(e.cX,e.cY,"whitePixel").setScale(e.width,e.height).setTint(0).setName("highScoreTableBG").setDepth(t-1).setInteractive();this.shaderImage=this.scene.add.image(e.cX,e.cY,"fireworks").setDepth(t-1).setScale(1/vars.shaders.fireworksRes).setName(`hs_shader`),this.shaderContainer="highScoreTable";let n=scene.add.image(e.cX,e.cY,"highScoreTable","highScoreTableBG").setDepth(t),i=scene.add.image(.25*e.width,.88*e.height,"highScoreTable","previousIcon").setDepth(t).setName("previousPage_HSTB").setVisible(!1).setInteractive(),s=scene.add.image(.75*e.width,.88*e.height,"highScoreTable","nextIcon").setDepth(t).setName("nextPage_HSTB").setVisible(!1).setInteractive(),o=scene.add.image(.75*e.width,.175*e.height,"highScoreTable","bestScoresIcon").setDepth(t).setName("scores_HSTB").setAlpha(0).setInteractive(),d=scene.add.image(.75*e.width,.175*e.height,"highScoreTable","bestTimesIcon").setDepth(t).setName("times_HSTB").setAlpha(1).setInteractive(),r=scene.add.image(e.cX,.175*e.height,"highScoreTable","headerHighScores").setName("headerHighScores").setDepth(t).setAlpha(1),l=scene.add.image(e.cX,.175*e.height,"highScoreTable","headerBestTimes").setName("headerBestTimes").setDepth(t).setAlpha(0),c=scene.add.image(e.cX,.875*e.height,"ui","closeOptionsIcon").setName("close_HSTB").setDepth(t+1).setAlpha(1).setInteractive();this.highScoreTableContainer.add([a,this.shaderImage,n,i,s,o,d,l,r,c]),this.highScoreTableContainer.setVisible(!1),this.buildHighScorePages(this.defaultSortBy),this.showHSTableButtons(!1),this.showHSTableReplayButtons(!1)}initNameEntry(){let e=consts.depths.inputPlayerName;this.inputContainer=this.scene.add.container().setName("scoreCardContainer").setDepth(e),this.containerNames.push(["inputName","scoreCardBG"]),this.scene.containers.inputName=this.inputContainer;let t=vars.localStorage.playerName;this.player={enteringName:!0,name:t};let a=consts.canvas,n=this.scene.add.image(a.cX,a.cY,"whitePixel").setScale(a.width,a.height).setTint(0).setName("scoreCardBG").setInteractive();this.inputContainer.add(n),this.scoreLetters=[["A","B","C","D","E","F","G","H","I","J"],["K","L","M","N","O","P","Q","R","S","T"],["U","V","W","X","Y","Z",".","-","<",">"]],this.name=this.player.name?this.player.name:"Enter Name...";let i=140,s=64,o=[80,96];this.scoreLetters.forEach(e=>{e.forEach(e=>{let t=this.scene.add.bitmapText(i,s,"scoreCard",e).setName(`HSL_${e}`).setOrigin(.5).setDropShadow(2,2).setTint(consts.tints.orange).setDepth(150).setInteractive();this.inputContainer.add(t),t.on("pointerup",e=>{let t=e.manager._tempHitTest[0].name;this.click(t)}),i+=o[0]}),i=140,s+=o[1]}),this.playerText=this.scene.add.bitmapText(a.cX/2,460,"scoreCard",this.name,64).setOrigin(.5).setName("txtPlayerName").setLetterSpacing(3).setTint(1013969).setDropShadow(2,2),this.inputContainer.add([this.playerText]),this.inputContainer.setScale(2).setVisible(!1)}animateLetter(e){vars.audio.playSound("buttonClick"),scene.tweens.add({targets:e,scale:1.2,duration:125,yoyo:!0})}buildHighScorePages(e="score"){"time"===e?null:e="score",this.defaultSortBy=e,8<this.highScoreTableContainer.list.length&&this.highScoreTableContainer.getAll().forEach(e=>{e.getData("position")&&Number.isInteger(e.getData("position"))&&e.destroy()});let t,a,n=[0,1];"time"===e?(t=n[1],a=n[0]):(t=n[0],a=n[1]);this.highScoreTableContainer.getByName("headerBestTimes").setAlpha(t),this.highScoreTableContainer.getByName("headerHighScores").setAlpha(a),"score"===e?this.scores.sort((e,t)=>t.score-e.score||e.time-t.time):this.scores.sort((e,t)=>e.time-t.time||e.score-t.score);this.highScoreTableBuildUIPages()}click(e){if(!e.startsWith("HSL_"))return!1;let t=e.replace("HSL_",""),a=!1;switch(vars.DEBUG?console.log(`Adding letter ${t} to current name`):null,"Enter Name..."===this.name&&(this.name=""),t){case"<":0<this.name.length&&(this.name=this.name.slice(0,-1)),vars.audio.playSound("deleteLetter"),a=!0;break;case">":vars.audio.playSound("acceptName"),this.updateHighScoreTable(),vars.DEBUG?console.log(`Showing the high score table`):null,this.buildHighScorePages(this.defaultSortBy),this.showInputContainer(!1),this.moveShaderToNewContainer("highScoreTable"),this.showHighScoreTable();break;default:if(17<this.name.length)return!1;this.name+=t;let e=this.inputContainer.getByName(`HSL_${t}`);this.animateLetter(e),a=!0;}a?this.playerText.setText(this.name):null}enableNameEntry(e=!0){e?(this.player.enteringName=!0,vars.containers.startIntroLoop(!1)):this.player.enteringName=!1}highScoreTableBuildUIPages(){let e=consts.canvas,t=consts.depths.highScoreTable,a=[...this.scores],n=[];for(;a.length;)n.push(a.splice(0,10));let i="scoreCard";this.currentPage=1,this.playersHiScorePage=1,this.totalPages=0;let s=1113872,o=300,d=consts.tints.highScores,r=consts.tints.orange,l="score"===this.defaultSortBy?{score:r,time:d}:{score:d,time:r};vars.DEBUG?console.groupCollapsed("%cHigh score pages >>>","color: #10FF10; font-size: 14px"):null,n.forEach((a,n)=>{this.totalPages=n+1,vars.DEBUG?console.log(`PAGE: ${this.totalPages}`):null,a.forEach((a,r)=>{let c=n+1,u=!1;this.score&&this.score===a.score&&this.time&&this.time==a.time&&(u=!0,this.playersHiScorePage=n+1);let g=n?0:1,h=r%10,p=r+1+10*n,m=getStringExtForInt(p),f=this.scene.add.bitmapText(.285*e.width,o+60*h,i,`${p}${m}`,50).setOrigin(1,.5).setLetterSpacing(2).setData({page:c,position:h+1}).setTint(d).setDepth(t).setAlpha(g);u?f.setTint(s):null;let S=this.scene.add.bitmapText(.3*e.width,o+60*h,i,a.name,50).setOrigin(0,.5).setLetterSpacing(2).setData({page:c,position:h+1}).setTint(d).setDepth(t).setAlpha(g);u?S.setTint(s):null;let D=a.solutionID?a.solutionID:0,k=this.scene.add.bitmapText(.64*e.width,o+60*h,i,a.score,50).setOrigin(1,.5).setLetterSpacing(2).setData({page:c,position:h+1}).setTint(l.score).setDepth(t).setAlpha(g);Number.isInteger(a.time)&&(a.time+=".0"),u?k.setTint(s):null;let C=this.scene.add.bitmapText(.735*e.width,o+60*h,i,`${a.time}s`,50).setOrigin(1,.5).setLetterSpacing(2).setData({page:c,position:h+1}).setTint(l.time).setDepth(t).setAlpha(g);u?C.setTint(s):null,this.highScoreTableContainer.add([f,S,k,C]);let b=null;D?(vars.DEBUG?console.log(`%cSolution ID: ${D} found for ${a.score} in ${a.time}, by ${a.name} (page ${c}, alpha: ${g})`,"color: #10FF10"):null,b=this.scene.add.image(.755*e.width,o+60*h-5,"ui","aiReplayIcon").setOrigin(.5,.5).setData({page:c,position:h+1}).setDepth(t).setAlpha(g).setName(`hSSolutionID_${D}`).setInteractive()):vars.DEBUG?console.log(`%cNo solution ID found for ${a.score} in ${a.time}, by ${a.name}`,"color: red"):null;b?this.highScoreTableContainer.add(b):null})}),vars.DEBUG?console.groupEnd():null;let c=!!(1<n.length);this.highScoreTableContainer.getByName("previousPage_HSTB").setVisible(c),this.highScoreTableContainer.getByName("nextPage_HSTB").setVisible(c),this.showHSTableButtons(!0),this.playersHiScorePage===this.currentPage?null:this.highScoreJumpToPage()}highScoreCheck(e){let t=e,a=[];this.scoreDetails.forEach(e=>{a.push(e[3])});let n=!1;if(a.forEach((e,a)=>{!1===n&&t>e&&(n=a)}),!1===n)return vars.DEBUG?console.log(`%cScore ${t} is NOT a high score`,"color: red"):null,this.showInputContainer(!0),!1;vars.DEBUG?console.log(`%cHigh score found. Pushing into index ${n}`,"color: green"):null,a.splice(n,0,t),a.pop(),vars.DEBUG?console.log(a):null;for(let a=3;a>=n;a--){this.scoreDetails[a+1][1]=this.scoreDetails[a][1],this.scoreDetails[a+1][3]=this.scoreDetails[a][3];let e=this.inputContainer.getByName(`scoreLine_${a}`);a===n&&(this.scoreDetails[a][1]="",this.scoreDetails[a][3]=t,this.playerText.setY(e.y),e.setText(`${this.scoreDetails[a][0]}    ${this.scoreDetails[a][3]}   ${this.scoreDetails[a][1]}`).setTint(this.scoreDetails[a][2]));let i=this.inputContainer.getByName(`scoreLine_${a+1}`),s=this.scoreDetails[a+1];i.setText(`${s[0]}    ${s[3]}   ${s[1]}`).setTint(s[2])}vars.DEBUG?console.table(this.scoreDetails):null,this.enableNameEntry(!0),this.showInputContainer(!0)}highScoreJumpToPage(){this.oldPage=1,this.currentPage=this.playersHiScorePage,this.showPage()}moveShaderToNewContainer(e=null){if(!vars.checkType(e,"string"))return!1;if(!this.shaderContainer||this.shaderContainer===e)return!1;let t=vars.containers.getByName(this.shaderContainer),a=vars.containers.getByName(e);if(!a||!t)return!1;t.remove(this.shaderImage),a.add(this.shaderImage),a.sendToBack(this.shaderImage);let n=null;this.containerNames.every(t=>{if(t[0]===e)return n=t[1],!0;return!0});let i=a.getByName(n);return i?void(a.sendToBack(i),this.shaderContainer=e):(console.warn(`Unable to find the background image name for container ${e}.\nThis means that containerNames is missing the container!`),!1)}showHighScoreTable(e=!0){let t=e?1:0;this.showHSTableButtons(e),this.showHSTableReplayButtons(e),this.highScoreTableContainer.setVisible(e),this.highScoreTableContainer.setAlpha(t)}showInputContainer(e=!0){e?this.inputContainer.setVisible(!0):this.inputContainer.setVisible(!1)}showHighScorePage(e=!0){this.oldPage=this.currentPage,e?this.currentPage<this.totalPages?this.currentPage++:this.currentPage=1:1<this.currentPage?this.currentPage--:this.currentPage=this.totalPages;this.showPage()}showHSTableButtons(e=!0){let t=this.highScoreTableContainer;["previousPage_HSTB","nextPage_HSTB","close_HSTB"].forEach(a=>{e?t.getByName(a).setAlpha(1):t.getByName(a).setAlpha(0)})}showHSTableReplayButtons(e=!0){let t=this.highScoreTableContainer;if(!e)t.getAll().forEach(e=>{e.name.startsWith("hSSolutionID_")&&e.setAlpha(0)});else{let e=vars.game.scoreCard;t.getAll().forEach(t=>{t.name.startsWith("hSSolutionID_")?t.getData("page")===e.currentPage?t.setAlpha(1):t.setAlpha(0):null})}return!1}showPage(){vars.DEBUG?console.log(`%cHiding page ${this.oldPage} and showing page ${this.currentPage}`,"color: black; background-color: yellow;"):null,this.highScoreTableContainer.getAll().forEach(e=>{if(e.getData("page")){let t=e.getData("page");this.oldPage&&t===this.oldPage&&e.setAlpha(0);t===this.currentPage&&e.setAlpha(1)}}),this.oldPage=null}switchVisible(){let e=this.highScoreTableContainer;["scores_HSTB","times_HSTB"].forEach(t=>{let a=e.getByName(t);a.alpha?a.setAlpha(0):a.setAlpha(1)})}updateHighScoreTable(){vars.DEBUG?console.log(`Updating the high score table`):null,(""===this.name||"Enter Name..."===this.name)&&(this.name="Player"),this.player.name=this.name,vars.localStorage.savePlayerName(this.name);let e={name:this.player.name,score:this.score,time:this.time,solutionID:this.solutionID};this.solutionID=null,vars.DEBUG?console.table({scoreData:e}):null,this.scores.push(e),arraySortByKey(this.scores,"score").reverse(),vars.localStorage.saveScores(this.scores)}};let Scroller=class{constructor(e,t,a,n,i,s,o,d={textBG:!0,textBGColour:0,fullScreenBG:!0,fullScreenColour:657930}){return!!this.verifyIncomingVars(e,t,a,n,s,o)&&void(this.scene=scene,this.fontSize=i?i:32,this.textBG=d.textBG,this.textBGCol=d.textBGColour,this.fullScreenBG=d.fullScreenBG,this.fullScreenBGCol=d.fullScreenColour,this.clickFrom=null,this.speed=1,this.paused=!1,this.reverse=!1,this.timeIncrementMultiplier=1,this.time=this.startTime=-this.height,this.loading=!0,this.loadRequiredFiles())}loadRequiredFiles(){this.defaultAssetsFolder="assets/Scroller/",this.scene.load.setPath(this.defaultAssetsFolder),this.scene.load.atlas("scroller",`scroller.png`,`scroller.json`),this.scene.load.once("complete",()=>{this.filesLoaded()})}filesLoaded(){vars.DEBUG?console.log(`Initialising the the scroller`):null,this.loading=!1,this.container=this.initContainer(),this.initPhaserObject(),this.initButtons()}verifyIncomingVars(e,t,a,n,i,s){return(this.errors=[],!Number.isInteger(e)||!Number.isInteger(t))?(this.errors.push(`Invalid width or height`),!1):Array.isArray(a)&&a.length?(this.border=Number.isInteger(i)?i:0,this.depth=Number.isInteger(s)?s:1,this.cC,consts&&consts.canvas?this.cC=consts.canvas:(this.cC={width:1920,height:1080,cX:960,cY:540},this.errors.push(`WARNING: consts.canvas doesnt exist. Using defaults. If these arent the canvas vars, you need to modify the cC var in verifyIncomingVars. RESULT: CONTINUING`),console.table(this.cC)),this.width=e<this.cC.width+1&&0<e?e:this.cC.width,this.height=t<this.cC.height+1&&0<t?t:this.cC.height,this.width<this.cC.width/10&&this.errors.push(`WARNING: The width requested (${this.width}) was less than ${this.cC.width/10}. RESULT_OF_WARNING: CONTINUING.`),this.height<this.cC.height/10&&this.errors.push(`WARNING: The height requested (${this.height}) was less than ${this.cC.width/10}. RESULT_OF_WARNING: CONTINUING.`),"string"==typeof n&&n.startsWith("#")?this.textColours=[n,n,0]:Array.isArray(n)&&2===n.length&&(this.textColours=[n[0],n[1],2]),(this.message=a,!0)):(this.errors.push(`Invalid message, or message length is 0`),!1)}initButtons(){this.buttons={};let e=.958*this.cC.width,t=this.cC.cY,a=200,n=[0,-a,2*-a,a,2*a];["pause","reverse","top","x1","close"].forEach((a,i)=>{let s=this.scene.add.image(e,t+n[i],"scroller",a).setName(`SCRL_${a}`).setDepth(this.depth).setInteractive(),o=scene.add.bitmapText(e,t+n[i]+64,"defaultFontSmall","x1"===a?"SPEED":a.toUpperCase(),18).setOrigin(.5).setDepth(this.depth);this.buttons[a]={button:s,text:o},this.container.add([s,o])})}initContainer(){scene.containers?null:scene.containers={},scene.containers.scrollers?null:scene.containers.scrollers=[];let e=scene.containers.scrollers.length;this.containerName=`scroller_${e}`;let t=scene.add.container();return t.setName(this.containerName).setDepth(this.depth).setVisible(!1).setAlpha(1),scene.containers.scrollers.push(t),t}initPhaserObject(){let e={fontFamily:"Consolas",fixedWidth:this.width-2*this.border,color:this.textColours[0],stroke:this.textColours[1],strokeThickness:this.textColours[2],fontSize:`${this.fontSize}px`,lineSpacing:10,wordWrap:{width:this.width}};if(this.textObject=scene.add.text(this.cC.cX,0,this.message,e).setOrigin(.5,0).setDepth(this.depth),this.maxHeight=this.textObject.height,this.textBG)if(this.fullScreenBG){let e=[this.cC.width,this.cC.height];this.fullScreenBGCol!==this.textBGCol&&(this.background=scene.add.image(this.cC.cX,0,"whitePixel").setTint(this.fullScreenBGCol).setOrigin(.5,0).setScale(e[0],e[1]),this.textBackground=scene.add.image(this.cC.cX,0,"whitePixel").setTint(this.textBGCol).setOrigin(.5,0).setScale(this.width,this.height),this.container.add([this.background,this.textBackground]))}else this.textBackground=scene.add.image(this.cC.cX,0,"whitePixel").setTint(this.textBGCol).setOrigin(.5,0).setScale(this.width,this.height),this.container.add(this.textBackground);this.container.add(this.textObject),this.textObject.setCrop(0,this.startTime,this.width,this.height)}click(e){switch(e=e.replace("SCRL_",""),e){case"close":return this.fadeIn(!1),!0;break;case"pause":let t=this.buttons.pause.button,a=this.buttons.pause.text;"pause"===t.frame.name?(this.paused=!0,t.setFrame("unpause"),a.setText("UNPAUSE")):(this.paused=!1,t.setFrame("pause"),a.setText("PAUSE"),this.resetSpeed());;break;case"reverse":let n=this.buttons.reverse.button;"reverse"===n.frame.name?n.setFrame("unreverse"):n.setFrame("reverse"),this.reverse=!this.reverse,this.resetSpeed();break;case"top":this.time=this.startTime,this.resetSpeed();break;case"x1":let i=this.buttons.x1.button;switch(i.frame.name){case"x1":this.speed=2;break;case"x2":this.speed=4;break;case"x4":this.resetSpeed();};i.setFrame(`x${this.speed}`);}}cropText(){this.textObject.setCrop(0,this.time,this.width,this.height),this.textObject.y=-this.time}fadeIn(e=!0){let t=e?1:0;if(e)this.container.setVisible(!0),this.container.setAlpha(0),this.time=this.startTime;else switch(this.clickFrom){case"mainScreen":vars.containers.ignoreLoop=!1;break;default:console.warn(`Unabled to figure out where we came from before showing the scroller!`),console.log(`"clickFrom" variable is: ${this.clickFrom}`);debugger;return!1;}scene.tweens.add({targets:this.container,alpha:t,duration:500,onComplete:(e,t)=>{t[0].alpha?null:t[0].setVisible(!1)}})}resetSpeed(){this.speed=1,this.buttons.x1.button.setFrame(`x${this.speed}`)}show(e=!0){this.container.setVisible(e)}update(){this.loading||!this.container.visible||this.paused||(this.reverse?this.time-this.speed>=this.startTime?this.time-=this.speed:this.time=this.maxHeight:this.time+this.speed>=this.maxHeight?this.time=this.startTime:this.time+=this.speed,this.cropText())}};let Unlockables=class{constructor(e){return this.unlockableSet=vars.localStorage.unlockables,delete vars.localStorage.unlockables,!!(e&&"object"==typeof e&&"object"==typeof e.add)&&void(this.scene=e,this.folder="Unlockables",this.available={cardSets:[],tints:[]},this.ULInts=vars.localStorage.options.ULInts,delete vars.localStorage.options.ULInts,this.fadingContainer=!1,this.showContainerDuration=750,this.optionsMinCount=0,this.tweens={},this.cC=consts.canvas,this.lbeVars=null,this.lootBoxEmuFinished=!0,this.state="Initialising",this.init(),this.currentlyVisible="options")}init(){this.scene.load.setPath("assets/"),this.initCardSetsAndTints(),this.initOtherFiles(),this.scene.load.once("complete",this.filesLoaded,this),this.scene.load.start()}initCardSetsAndTints(){for(let e in this.available={cardSets:[],tints:[]},this.unlockableSet)if(e.startsWith("cS"))this.available.cardSets.push([e.replace("cS",""),this.unlockableSet[e].unlocked,this.unlockableSet[e].id]);else if(e.startsWith("tint")){let t=e.replace("tint",""),a=Phaser.Display.Color.HexStringToColor(t).color;this.unlockableSet[e].intVal=a,this.available.tints.push([t,this.unlockableSet[e].unlocked,this.unlockableSet[e].id,a])}else console.warn(`Unknown type: ${e}`);this.readyCardSetsForLoader()}initOtherFiles(){this.scene.load.image(`bgLootFade`,`${this.folder}/ui/bgLootFade.png`),this.scene.load.atlas("unlockUI",`${this.folder}/ui/unlockable.png`,`${this.folder}/ui/unlockable.json`),this.scene.load.audio("tick",`${this.folder}/audio/tick.ogg`)}filesLoaded(){this.buildUI()}readyCardSetsForLoader(){let e="cardSets";this.available.cardSets.forEach(t=>{this.scene.load.atlas(t[0],`${this.folder}/${e}/${t[0]}/unlockable.png`,`${this.folder}/${e}/${t[0]}/unlockable.json`)})}animateRandomRollButton(){this.tweens.randomRollButton=this.scene.tweens.add({targets:this.randomRollText,scale:1.1,duration:2e3,yoyo:!0,repeat:-1,ease:"Power1",paused:!0})}buildLootBoxEmu(){let e=this.containers.lootboxemu,t=this.cC;this.scrollerBG=this.scene.add.image(t.cX,t.cY,"whitePixel").setScale(t.width,t.height).setTint(0).setName("lootboxemuBG").setInteractive(),e.add(this.scrollerBG),this.scrollerBG.on("pointerup",this.click,this.scrollerBG),this.fgFade=this.scene.add.image(0,0,"bgLootFade").setOrigin(0).setScale(1,consts.canvas.height).setDepth(5).setName(`fgFade`),this.topPointer=this.scene.add.image(this.cC.cX,10,"unlockUI","pointerDown").setOrigin(.5,0).setDepth(3).setName(`topPointer`),this.lowerPointer=this.scene.add.image(this.cC.cX,this.cC.height-10,"unlockUI","pointerDown").setOrigin(.5,1).setDepth(3).setName(`lowerPointer`).setFlipY(!0),this.winHighlight=this.scene.add.image(this.cC.cX,this.cC.cY,"unlockUI","winHighlight").setDepth(5).setName(`winHighlight`);let a="Consolas";this.unlockName=this.scene.add.text(this.cC.cX,this.cC.cY-140,"???",{fontFamily:a,fontSize:20,color:consts.htmlColours.orange}).setName(`unlockName`),this.unlockName.setStroke(consts.htmlColours.blueDark,2).setOrigin(.5).setDepth(4).setData({actualID:null}),this.unlockName.setShadow(2,2,"#333333",2,!0,!0),this.typeTextObject=this.scene.add.text(this.cC.cX,this.cC.cY+140,"???",{fontFamily:a,fontSize:20,color:consts.htmlColours.orange}).setName(`unlockTypeText`),this.typeTextObject.setStroke(consts.htmlColours.blueDark,2).setOrigin(.5).setDepth(4),this.typeTextObject.setShadow(2,2,"#333333",2,!0,!0),e.add([this.fgFade,this.topPointer,this.lowerPointer,this.winHighlight,this.typeTextObject,this.unlockName])}buildOptions(){let e=this.containers.options,t=this.containers.unlocked,a=this.scene.add.image(215,615,"ui","previousIcon").setName(`UNL_previous`).setInteractive(),n=this.scene.add.bitmapText(495,613,"defaultFont",`PAGE ${this.currentPage+1} of ${this.totalPages}`,48).setOrigin(.5).setDepth(2),i=this.scene.add.image(785,615,"ui","nextIcon").setName(`UNL_next`).setInteractive();e.add([a,i,n]);let s=this.scene.add.image(100,655,"ui","previousIcon").setName(`UNLD_previous`).setInteractive(),o=this.scene.add.bitmapText(380,653,"defaultFont",`PAGE 0 of 0`,48).setOrigin(.5).setDepth(2),d=this.scene.add.image(670,655,"ui","nextIcon").setName(`UNLD_next`).setInteractive();t.add([s,o,d]),a.on("pointerup",this.click,a),i.on("pointerup",this.click,i),s.on("pointerup",this.click,s),d.on("pointerup",this.click,d),this.UIButtonsAndText={prev:a,pageText:n,next:i},this.UIButtonsAndTextUnlocked={prev:s,pageText:o,next:d};let r=this.scene.add.image(40,-15,"unlockUI","selectorLeft").setOrigin(0,1),l=r.width,c=this.scene.add.image(40+l,-15,"unlockUI","selectorRight").setOrigin(0,1),u=c.getCenter();this.randomRollText=this.scene.add.image(u.x,u.y,"unlockUI","randomRollText").setName("randomRoll").setInteractive(),this.animateRandomRollButton(),this.showRandomRollButton(),this.randomRollText.on("pointerup",this.click,this.randomRollText),this.currentTypeText=scene.add.bitmapText(60,-70,"defaultFont","CARDSETS",64).setName("options_currentType").setOrigin(0,.5).setTint(consts.tints.orange),e.add([r,c,this.randomRollText,this.currentTypeText]),this.tintTick=scene.add.image(100,400,"ui","yesIcon").setOrigin(.5,1).setData({page:1,delete:!1}),this.cardTick=scene.add.image(100,400,"ui","yesIcon").setOrigin(.5,1).setData({page:1,delete:!1}),t.add([this.tintTick,this.cardTick]),e.setPosition(735,325),t.setPosition(875,265),this.optionsMinCount=e.length,this.unlockKeys=[];let g=this.unlockableSet;for(let e in g)g[e].unlocked||this.unlockKeys.push(e);this.buildPages()}buildUI(){this.state="Building",this.containersAndGroupsInit(),this.buildOptions(),this.buildLootBoxEmu(),this.hideAllContainers(),this.state="Ready"}containersAndGroupsInit(){this.containers={options:null,lootboxemu:null,unlocked:null};let e=consts.depths;this.containers.options=this.scene.add.container().setName("options").setDepth(e.options+10),this.containers.unlocked=this.scene.add.container().setName("unlocked").setDepth(e.options+10),this.containers.lootboxemu=this.scene.add.container().setName("lootBoxEmu").setDepth(e.options+15),this.unlockGroup=this.scene.add.group().setName("unlockGroup")}animatedUnlock(e=null){if(null===e)return!1;let t,a=this.containers.options;if(e.name.startsWith("tint_"))t="tint";else if(e.name.startsWith("cardSet_"))t="cardSet";else return console.error(`Passed object name (${e.name}) doesnt start with tint or cardSet. Failing gracefully!`),!1;if("tint"===t){let t=e,n=a.x,i=a.y,s=a.depth;return a.remove(t),t.setPosition(t.x+n+t.scaleX/2,t.y+i+t.scaleY/2).setDepth(s+5).setOrigin(.5),scene.tweens.addCounter({from:0,to:1,duration:100,onComplete:vars.UI.displayUnlock,onCompleteParams:[t]}),!0}return"cardSet"===t?(vars.DEBUG?console.log(`Animating Card Set Unlock!`):null,!0):(console.error(`This unlock (${e.name}) has no handler code yet!`),!1)}click(){let e=vars.game,t=e.unlockables;if(this.name.startsWith("UNL_")){if(this.name.endsWith("previous"))return t.optionsShowPage(!1),!0;if(this.name.endsWith("next"))return t.optionsShowPage(!0),!0}else if(this.name.startsWith("UNLD_")){if(this.name.endsWith("previous"))return t.optionsShowPageULD(!1),!0;if(this.name.endsWith("next"))return t.optionsShowPageULD(!0),!0}else{if("lootboxemuBG"===this.name)return!!t.lootBoxEmuFinished&&(vars.game.unlockables.scrollerSwipe(),!0);if("randomRoll"===this.name){let a=consts.unlockPoints;return!!(e.unlockPoints>=a.randomRoll)&&(t.lootBoxEmuFinished=!1,e.unlockables.useUnlockPoints(a.randomRoll),vars.game.unlockables.startScroller(),!0)}if(this.name.startsWith("CSU_")||this.name.startsWith("TU_")){if(this.name.startsWith("CSU_")){vars.DEBUG?console.log(`Unlocked card set clicked on. Swapping current card set with this one.`):null;let t=this.getData("cardSetName");return vars.localStorage.saveCardSet(t),e.unlockables.moveCardTick(this),e.setCardSet(t),!0}if(this.name.startsWith("TU_")){let t=this.name.replace("TU_","");vars.DEBUG?console.log(`Unlocked tint set clicked on. Swapping current background tint with this one (#${t}).`):null;let a=vars.localStorage.options.tint;return a.toString(16).toUpperCase()!==t&&(e.setBGTint(t),e.unlockables.moveTintTick(this),!0)}}}vars.DEBUG?console.log(`Button ${this.name} has no handler!`):null}buildPages(){this.rebuildPages()}destroyAllPages(){this.containers.options.getAll().forEach(e=>{e.getData("delete")?e.destroy():null}),this.containers.unlocked.getAll().forEach(e=>{e.getData("delete")?e.destroy():null})}displayUnlock(e){let t=e,a=e.name.startsWith("tint_")?"tint":e.name.startsWith("cardSet_")?"cardSet":null;if(!a)return!1;let n=this.containers.options.depth,i=this.scene.add.image(this.cC.cX,this.cC.cY,"whitePixel").setScale(this.cC.width,this.cC.height).setDepth(n+3).setAlpha(0).setTint(0),s=this.scene.add.bitmapText(this.cC.cX,this.cC.cY/2,"defaultFont",`NEW ${a.toUpperCase()} UNLOCKED`,64).setLetterSpacing(5).setOrigin(.5).setTint(consts.tints.orange).setAlpha(0).setDepth(n+4),o=100;scene.tweens.add({targets:[s,i],alpha:1,duration:o,onComplete:()=>{vars.DEBUG?console.log("Rebuilding pages"):null,vars.game.unlockables.rebuildPages()}}),"tint"===a&&scene.tweens.add({targets:t,angle:-360,x:consts.canvas.cX,y:consts.canvas.cY,delay:o,duration:1e3,hold:2e3,yoyo:!0,onYoyo:()=>{scene.tweens.add({targets:[t,i,s],alpha:0,duration:900})},onComplete:()=>{t.destroy(),i.destroy(),s.destroy()}})}getCardSetName(e){let t=e.toUpperCase();if(t.includes("_")){t=t.split("_");let e=t.shift();t.push(e),t=t.join(" ")}return t}getSetName(){let e=[];for(let t in this.unlockableSets[`page_${this.currentPage}`]){let a=t.split("_")[0];e.includes(a)?null:e.push(a)}let t="";return e.forEach(e=>{t+=`${e.toUpperCase()}S & `}),t.slice(0,-3)}hideAllContainers(){for(let e in this.containers)this.containers[e].setAlpha(0).setVisible(!1)}moveCardTick(e=null){if(!e)return!1;let t=e.getData("page"),a=e.getBottomCenter();this.cardTick.setPosition(a.x,a.y-20),this.cardTick.setData({page:t}),this.cardTick.setAlpha(1).setVisible(!0)}moveTintTick(e=null){if(!e)return!1;let t=e.getData("page"),a=e.getBottomCenter();this.tintTick.setPosition(a.x,a.y-20),this.tintTick.setData({page:t}),this.tintTick.setAlpha(1).setVisible(!0)}optionsShowPage(e=!0){let t=this.unlockableSets[`page_${this.currentPage}`];for(let a in t)t[a].objects.forEach(e=>{e.setVisible(!1)});for(let a in e?this.currentPage+1<this.totalPages?this.currentPage++:this.currentPage=0:0<this.currentPage?this.currentPage--:this.currentPage=this.totalPages-1,t=this.unlockableSets[`page_${this.currentPage}`],t)t[a].objects.forEach(e=>{e.setVisible(!0)});this.UIButtonsAndText.pageText.setText(`PAGE ${this.currentPage+1} of ${this.totalPages}`);let a=this.getSetName();this.currentTypeText.setText(a)}optionsShowPageULD(e=!0){let t=this.containers.unlocked,a=this.ULd.currentPage;e?this.ULd.currentPage+1<this.ULd.pages?this.ULd.currentPage++:this.ULd.currentPage=0:0<this.ULd.currentPage?this.ULd.currentPage--:this.ULd.currentPage=this.ULd.pages-1;t=vars.game.unlockables.containers.unlocked,t.getAll().forEach(e=>{e.data&&(e.getData("page")===a&&e.setAlpha(0).setVisible(!1),e.getData("page")===this.ULd.currentPage&&e.setAlpha(1).setVisible(!0))}),this.UIButtonsAndTextUnlocked.pageText.setText(`PAGE ${this.ULd.currentPage+1} of ${this.ULd.pages}`)}rebuildPages(){vars.DEBUG?console.groupCollapsed(`%cRebuilding unlockables pages >>>`,`${consts.console.defaults} ${consts.console.colours.important}`):null;let e=this.containers.options,t=this.containers.unlocked;this.ULd={xMin:60,x:60,xInc:200,yMin:60,y:60,yInc:280,tintWidth:154,tintHeight:234,unlockedCount:0,pages:0,currentPage:0,maxPerPage:10},e.length>this.optionsMinCount?this.destroyAllPages():null,this.currentPage=0;let a=500,n=300,i=35,s=1;this.totalPages=0;let o=4;this.unlockableSets={page_0:{}};let d=vars.game,r=0,l=-1,c=0,u=472,g=26,h="Consolas";this.cardSetContainers={},this.available.cardSets.forEach(p=>{let m=this.unlockableSets[`page_${r}`];if(!p[1]){l++;let t=p[0],d=~~(l/2)*n%(2*n);r=~~(l/o),this.totalPages=r+1,this.cardSetContainers[`page_${r}`]?null:this.cardSetContainers[`page_${r}`]={},this.cardSetContainers[`page_${r}`][t]=[];let f=this.scene.add.group().setName(`page_${r}_${t}`);this.cardSetContainers[`page_${r}`][t].push(f),this.unlockableSets[`page_${r}`]?null:m=this.unlockableSets[`page_${r}`]={},m[`cardSet_${t}`]={},m[`cardSet_${t}`].unlocked=!1,m[`cardSet_${t}`].objects=[];let S=!r,D=!1;["AH","AD","AS","AC","00"].forEach((n,o)=>{let r=o*80+l%2*a+i;!1===D?D=r:null;let u=this.scene.add.image(r,d,t,n).setName(`ulCard`).setData({delete:!0,moving:!1}).setScale(s).setOrigin(0).setVisible(S);c?null:c=u.height*s,m[`cardSet_${t}`].objects.push(u),e.add(u),f.add(u)});let k=t.includes("gold")||t.includes("silver")||t.includes("bronze")?consts.unlockPoints.special:consts.unlockPoints.cardSet,C=this.scene.add.image(D+1,d+c,"whitePixel").setData({delete:!0,cost:k}).setName(`unlock_cS_${t}`).setAlpha(.7).setVisible(S).setScale(u,90).setOrigin(0,1).setTint(0).setInteractive(),b=this.scene.add.image(D+u,d+7,"unlockUI","unlockIcon").setData({delete:!0,cost:k}).setName(`unlock_cSUI_${t}`).setVisible(S).setOrigin(1,0).setInteractive(),y=this.getCardSetName(t),T=this.scene.add.text(D+u/2,d+c-12,`${y} card set`,{fontFamily:h,fontSize:g,color:consts.htmlColours.orange}).setData({delete:!0}).setOrigin(.5,1).setVisible(S),x=this.scene.add.text(D+u/2,d+c-50,`${k} UPs`,{fontFamily:h,fontSize:g,color:consts.htmlColours.orange}).setData({delete:!0}).setOrigin(.5,1).setVisible(S).setStroke(consts.htmlColours.blueDark,2).setShadow(2,2,"#333333",2,!0,!0);T.setStroke(consts.htmlColours.blueDark,2),T.setShadow(2,2,"#333333",2,!0,!0),m[`cardSet_${t}`].objects.push(C,T,b,x),e.add([C,T,b,x]),f.addMultiple([C,T,b,x])}else{vars.DEBUG?console.log(`%cUnlocked: ${p}`,`${consts.console.defaults}${consts.console.colours.good}`):null;let e=this.getCardSetName(p[0]),a=~~(this.ULd.unlockedCount/this.ULd.maxPerPage),n=p[0],i=this.scene.add.image(this.ULd.x,this.ULd.y,n,"AH").setOrigin(1,0).setName(`CSU_${e}`).setData({page:a,delete:!0}).setInteractive();if(i.on("pointerup",this.click,i),n===d.cardSet){let e=i.getBottomCenter();this.cardTick.setPosition(e.x,e.y-20),this.cardTick.setData({page:a}),a?this.cardTick.setAlpha(0):this.cardTick.setAlpha(1)}a?i.setAlpha(0).setVisible(!1):null,i.setData({page:a,delete:!0,cardSetName:p[0]}),this.ULd.unlockedCount++,t.add(i),this.ULd.x+this.ULd.xInc<5*this.ULd.xInc+this.ULd.xMin?this.ULd.x+=this.ULd.xInc:this.ULd.x=this.ULd.xMin,this.ULd.x===this.ULd.xMin&&(this.ULd.y<this.ULd.yInc?this.ULd.y+=this.ULd.yInc:this.ULd.y=this.ULd.yMin)}}),this.graphicSets={};let p=this.available.tints;p.forEach(s=>{if(!s[1]){l++;let t=s[0],d=s[3],p=t,m=`tint_${p}`,f=l%2*a+i,S=~~(l/2)*n%(2*n);r=~~(l/o),this.totalPages=r+1,this.unlockableSets[`page_${r}`]?null:this.unlockableSets[`page_${r}`]={};let D=this.unlockableSets[`page_${r}`];D[m]={},D[m].unlocked=!1;let k=!r,C=consts.unlockPoints.tint,b=this.scene.add.image(f,S,"whitePixel").setTint(d).setData({delete:!0,moving:!1}).setName(m).setOrigin(0,0).setScale(u,c).setVisible(k);D[m].objects=[b];let y=this.scene.add.image(f,S+c,"whitePixel").setData({delete:!0,cost:C}).setName(`unlock_tint_${p}`).setAlpha(.7).setVisible(k).setScale(u,90).setOrigin(0,1).setTint(0).setInteractive(),T=this.scene.add.text(f+u/2,S+c-50,`${C} UPs`,{fontFamily:h,fontSize:g,color:consts.htmlColours.orange}).setData({delete:!0}).setOrigin(.5,1).setVisible(k).setStroke(consts.htmlColours.blueDark,2).setShadow(2,2,"#333333",2,!0,!0),x=this.scene.add.text(f+u/2,S+c-12,`TINT: ${p.toUpperCase()}`,{fontFamily:h,fontSize:g,color:consts.htmlColours.orange}).setData({delete:!0}).setOrigin(.5,1).setVisible(k);x.setStroke(consts.htmlColours.blueDark,2),x.setShadow(2,2,"#333333",2,!0,!0);let w=this.scene.add.image(f+u,S+7,"unlockUI","unlockIcon").setData({delete:!0,cost:C}).setName(`unlock_tintUI_${p}`).setVisible(k).setOrigin(1,0).setInteractive();D[m].objects.push(y,x,w,T),e.add([b,y,x,w,T])}else{vars.DEBUG?console.log(`%cUnlocked ${s}`,`${consts.console.defaults} #${s[0]}`):null;let e=this.scene.add.image(this.ULd.x,this.ULd.y,"whitePixel").setOrigin(1,0).setTint(s[3]).setName(`TU_${s[0]}`).setScale(this.ULd.tintWidth,this.ULd.tintHeight).setInteractive(),a=this.scene.add.image(this.ULd.x,this.ULd.y,"unlockUI","unlockedTintFG").setOrigin(1,0);e.on("pointerup",this.click,e);let n=~~(this.ULd.unlockedCount/this.ULd.maxPerPage);if(n?e.setAlpha(0).setVisible(!1):null,s[3]===vars.gameScreen.tint){let t=e.getBottomCenter();this.tintTick.setPosition(t.x,t.y-20),this.tintTick.setData({page:n}),n?this.tintTick.setAlpha(0):this.tintTick.setAlpha(1)}e.setData({page:n,delete:!0}),a.setData({page:n,delete:!0}),this.ULd.unlockedCount++,t.add([e,a]),this.ULd.x+this.ULd.xInc<5*this.ULd.xInc+this.ULd.xMin?this.ULd.x+=this.ULd.xInc:this.ULd.x=this.ULd.xMin,this.ULd.x===this.ULd.xMin&&(this.ULd.y<this.ULd.yInc?this.ULd.y+=this.ULd.yInc:this.ULd.y=this.ULd.yMin)}}),vars.DEBUG?console.groupEnd():null,this.UIButtonsAndText.pageText.setText(`PAGE ${this.currentPage+1} of ${this.totalPages}`);let m=!!(1<this.totalPages),f=m?1:0;for(let e in this.UIButtonsAndText)this.UIButtonsAndText[e].setAlpha(f).setVisible(m);for(let e in this.ULd.pages=~~(this.ULd.unlockedCount/this.ULd.maxPerPage)+1,m=!!(1<this.ULd.pages),f=m?1:0,1<this.ULd.pages&&this.UIButtonsAndTextUnlocked.pageText.setText(`PAGE ${this.ULd.currentPage+1} of ${this.ULd.pages}`),this.UIButtonsAndTextUnlocked)this.UIButtonsAndTextUnlocked[e].setAlpha(f).setVisible(m);this.containers.unlocked.bringToTop(this.tintTick),this.containers.unlocked.bringToTop(this.cardTick)}showContainer(e){if(!this.containers[e])return!1;let t=this.containers[e],a=!t.visible,n=a?1:0;t.setAlpha(n).setVisible(a)}showRandomRollButton(){vars.game.unlockPoints<consts.unlockPoints.randomRoll?(this.randomRollText.setFrame("randomRollUnavailableText").disableInteractive(),this.tweens.randomRollButton.paused=!0):(this.randomRollText.setFrame("randomRollText").setInteractive(),this.tweens.randomRollButton.paused=!1)}switchVisibleContainer(){let e=this.containers.options,t=this.containers.unlocked,a=!!e.visible,n=!!t.visible;if(a===n)return!1;let i,s;a?(i=e,s=t):(i=t,s=e);let o=a?"unlockedHeader":"unlockablesHeader";scene.containers.optionsScreen.getByName("unlockablesHeader").setFrame(o),scene.tweens.add({targets:i,alpha:0,duration:250,onComplete:(e,t)=>{t[0].setVisible(!1),s.setVisible(!0),scene.tweens.add({targets:s,alpha:1,duration:250})}})}unlockableShake(e){return!e[0].data.list.moving&&void e.forEach(e=>{e.setData("moving",!0),scene.tweens.add({targets:e,x:e.x-5,duration:framesToMs(5),yoyo:!0,repeat:2,onComplete:(e,t)=>{t[0].setData("moving",!1)}})})}unlockSpecific(e,t){let a,n=e.name;if("tint"===t)a=n.replace("unlock_tint_","").replace("unlock_tintUI_","");else if("cardSet"===t)a=n.replace("unlock_cS_","").replace("unlock_cSUI_","");else return vars.DEBUG?console.log(`Unknown type (${t}). Failing gracefully`):null,!1;let i=e.getData("cost");if(!i)return console.error(`Cost wasnt found!`),!1;if(i>vars.game.unlockPoints){vars.DEBUG?console.log(`Player doesnt have enough UP's to unlock this. Giving visual feedback.`):null;let e=this.unlockableSets,n=a,i=[];for(let a in e)if(!i.length){let s=`${t}_${n}`;e[a][s]&&(i=e[a][s].objects)}return i.length?this.unlockableShake(i):null,!1}this.useUnlockPoints(i);let s=`${t}_${a}`;debugger;let o=this.containers.options.getByName(s);this.animatedUnlock(o)}updateUIUnlockPoints(){vars.containers.getByName("optionsScreen").getByName(`optionsScreenUPCount`).setText(vars.game.unlockPoints),vars.containers.getByName("gamePlayingUI").getByName(`playersUPCount`).setText(vars.game.unlockPoints)}useUnlockPoints(e){let t=vars.game,a=t.unlockPoints;return!(e>a)&&void(t.unlockPoints-=e,this.showRandomRollButton(),vars.localStorage.updateUnlockPoints(),this.updateUIUnlockPoints(),this.showRandomRollButton())}startScroller(){this.generateLootBoxScroller(),this.showContainer("lootboxemu"),this.scrollTheEmu()}generateLootBoxScroller(){let e=154,t=234;this.lbeVars={speed:0,maxSpeed:100,speedingUp:!0,delay:180,enabled:!0,speedScale:1,cardWidth:154,cardHeight:t};let a=this.cC;this.onScreen=[];let n=this.containers.lootboxemu,i=38,s=a.cY,o=shuffle(this.unlockKeys);for(;i<a.width+e;){let a,d=o.shift();if(d.startsWith("cS")){let e=d.replace("cS","");a=this.scene.add.image(i,s,e,"AH").setOrigin(1,.5).setName(d).setDepth(2)}else if(d.startsWith("tint")){let n=this.unlockableSet[d].intVal;a=this.scene.add.image(i,s,"whitePixel").setOrigin(1,.5).setScale(e,t).setTint(n).setName(d).setDepth(2)}n.add(a),this.unlockGroup.add(a),i+=200}this.scrollerBringToTops()}scrollTheEmu(){vars.DEBUG?console.log(`STARTING THE SCROLLER!`):null,this.scrollUpdate()}scrollUpdate(){let e=this.lbeVars;if(!e.enabled)return!1;if(e.speed<e.maxSpeed&&e.speedingUp)e.speed++;else if(0<e.delay)e.delay--;else if(0<e.speed&&!e.speedingUp)e.speed--;else if(e.speedingUp)e.speedingUp=!1;else if(!e.speed&&!e.speedingUp)return this.lbeVars=null,e.enabled=!1,this.scrollToNearest(),!0;if(this.unlockGroup.incX(-e.speed),this.unlockGroup.getFirstAlive().getLeftCenter().x<=-e.cardWidth){let e=this.unlockGroup.getFirstAlive(),t=0-e.getRightCenter().x,a=e.name;e.destroy(),shuffle(this.unlockKeys),this.addUnlockableToGroup(t),this.unlockKeys.push(a)}if(1032>this.unlockGroup.children.entries[5].getLeftCenter().x&&!this.unlockGroup.children.entries[5].shown){vars.audio.playSound("tick");let e=this.unlockGroup.children.entries[5];e.shown=!0;let t=e.name.startsWith("tint")?"TINT":e.name.startsWith("cS")?"CARD SET":"???";this.typeTextObject.setText(t);let a="";a="TINT"==t?e.name.replace("tint",""):"CARD SET"===t?e.name.replace("cS","").replaceAll("_","\n"):"???",this.unlockName.setText(a).setData({actualID:e.name})}e.enabled||(vars.DEBUG?console.log(`Scroller has just stopped, panning to the closest unlock.`):null)}addUnlockableToGroup(e=0){let t,a=this.unlockKeys.shift(),n=this.cC.width+280-e,i=this.cC.cY,s=this.containers.lootboxemu;if(a.startsWith("cS")){let e=a.replace("cS","");t=this.scene.add.image(n,i,e,"AH").setOrigin(1,.5).setName(a).setDepth(2)}else if(a.startsWith("tint")){let e=this.unlockableSet[a].intVal;t=this.scene.add.image(n,i,"whitePixel").setOrigin(1,.5).setScale(this.lbeVars.cardWidth,this.lbeVars.cardHeight).setTint(e).setName(a).setDepth(2)}s.add(t),this.unlockGroup.add(t),this.scrollerBringToTops()}scrollerBringToTops(){this.containers.lootboxemu.bringToTop(this.fgFade),this.containers.lootboxemu.bringToTop(this.winHighlight)}scrollToNearest(){vars.game.unlockables.scrollerWaitingOnCount=0,this.unlockGroup.getChildren().forEach(e=>{vars.game.unlockables.scrollerWaitingOnCount++,this.scene.tweens.add({targets:e,x:e.x-102,delay:250,duration:1e3,ease:"Quad.easeInOut",onComplete:()=>{let e=vars.game.unlockables;e.scrollerWaitingOnCount--,e.scrollerWaitingOnCount?null:vars.game.scrollerHideNotWons()}})})}scrollerHideNotWons(){this.unlockRandomRoll();let e=1,t=!1,a=0,n=this.unlockGroup;n.getChildren().forEach(n=>{a++,n.index=a;let i=250*(e-1);6!==e||t||(i=0,t=!0);6!==e&&this.scene.tweens.add({targets:n,alpha:.1,delay:i,duration:500,onComplete:(e,t)=>{5===n.index?vars.game.scrollerZoomInOnWin():null,t[0].destroy()}});!t&&6>e?e++:null,t?e--:null})}unlockRandomRoll(){vars.DEBUG?console.log(`LOOTBOXEMU: Unlocking random roll!`):null;let e=this.unlockName.getData("actualID");this.unlockableSet[e].unlocked=!0,this.unlockKeys.every((t,a)=>t!==e||(vars.DEBUG?console.log(`Found unlock ${t} at index ${a}. Removing it from the unlockKeys array.`):null,this.unlockKeys.splice(a,1),!0));let t="",a=null;if(e.startsWith("tint")?(t=e.replace("tint",""),a=this.available.tints):e.startsWith("cS")?(t=e.replace("cS",""),a=this.available.cardSets):console.error("Unknown unlock type!"),t&&a){let e=vars.localStorage;a.every(a=>{if(t===a[0]){a[1]=!0;let t=a[2];return this.ULInts.push(t),e.saveUnlockIDs(this.ULInts),!0}return!0}),e.saveUnlocks(this.unlockableSet),vars.DEBUG?console.log(`REBUILDING THE UNLOCKABLE and UNLOCKED PAGES`):null,this.rebuildPages()}else console.error(`Searching for (${t}) or available array isnt valid!`)}scrollerZoomInOnWin(){let e=scene.cameras.main;return!(1!==e.zoom)&&void(this.scene.tweens.add({targets:[this.lowerPointer,this.topPointer],alpha:0,duration:750}),this.scene.tweens.add({targets:e,zoom:1.9,duration:2e3,hold:500,ease:"Quad.easeInOut",onComplete:()=>{scene.tweens.add({targets:scene.cameras.main,zoom:1,duration:500,onComplete:vars.game.scrollerShowWinMessage})}}),scene.tweens.addCounter({from:0,to:120,onComplete:()=>{vars.game.scrollerShaderAdd()}}))}scrollerShaderAdd(){let e=vars.shaders.generateTextureFromFireworksShader(),t=this.containers.lootboxemu;t.add(e),t.sendToBack(e),t.sendToBack(this.scrollerBG),this.fgFade.setAlpha(0)}scrollerShowWinMessage(){let e=this.containers.lootboxemu,t=this.scene.add.image(this.cC.cX,20,"unlockUI","wellDoneText").setOrigin(.5,0),a=this.scene.add.image(this.cC.cX,this.cC.height-20,"unlockUI","newUnlockText").setOrigin(.5,1);e.add([t,a]),this.winTweens=[];let n=this.scene.tweens.add({targets:[t,a],scale:.8,ease:"Bounce.easeOut",duration:2e3,hold:500,repeat:-1,yoyo:!0});this.winTweens.push(n),this.lootBoxEmuFinished=!0}scrollerSwipe(){let e=vars.game.unlockables.containers.lootboxemu;scene.tweens.add({targets:e,y:-1080,alpha:0,duration:500,ease:"Quad.easeIn",onComplete:vars.game.scrollerDestroy})}scrollerDestroy(){let e=this.containers.lootboxemu;this.winTweens.forEach(e=>{e.remove()});let t=["unlockName","unlockTypeText","lootboxemuBG","topPointer","lowerPointer","fgFade","winHighlight"];e.getAll().forEach(e=>{t.includes(e.name)?e.setAlpha(1):e.destroy()}),e.setPosition(0,0).setAlpha(0).setVisible(!1)}};let winDance=class{constructor(e){this.force=!!vars.checkType(e,"string")&&e,vars.DEBUG?!1===this.force?console.log(`Running random win dance`):console.log(`Running win dance ${e}`):null,this.preInit(),this.init()}preInit(){let e=consts.canvas;this.winDanceSets={simpleDiamond:{type:"tween",points:[[.2*e.width,e.cY],[e.cX,.3*e.cY],[.8*e.width,e.cY],[e.cX,.8*e.height]],repeat:2},betterDiamond:{type:"tween",points:[[e.cX,.7*e.height],[.4*e.width,.5*e.height],[e.cX,.3*e.height],[.6*e.width,e.cY],[e.cX,.8*e.height],[.7*e.width,e.cY],[e.cX,.2*e.height],[.3*e.width,.5*e.height],[e.cX,.8*e.height]],repeat:0},simpleSquare:{type:"tween",points:[[.2*e.width,.8*e.height],[.2*e.width,.2*e.height],[.8*e.width,.2*e.height],[.8*e.width,.8*e.height],[e.cX,.8*e.height]],repeat:2},simpleX:{type:"tween",points:[[e.cX,e.cY],[.2*e.width,.8*e.height],[.1*e.width,.7*e.height],[.8*e.cX,e.cY],[.1*e.width,.3*e.height],[.2*e.width,.2*e.height],[e.cX,.8*e.cY],[.8*e.width,.2*e.height],[.9*e.width,.3*e.height],[1.2*e.cX,e.cY],[.9*e.width,.7*e.height],[.8*e.width,.8*e.height],[e.cX,e.cY],[e.cX,.8*e.height]],repeat:2},winText:{type:"tween",points:[[-100,.8*e.height],[-100,.2*e.height],[60,150],[210,850],[360,450],[510,850],[660,150],[960,150],[960,850],[1260,850],[1260,150],[1860,850],[1860,150],[1.1*e.width,.2*e.height],[1.1*e.width,.8*e.height],[e.cX,.8*e.height]],repeat:1}}}init(){vars.audio.playSound("applause"),this.moveAllCardsToWD(),this.complete=0;let e=this.getRandomWinDance(),t=scene.groups.winDance.getChildren();this.totalCards=t.length;let a=e[0][0],n=e[0][1];t.forEach((t,i)=>{let s=Phaser.Math.Distance.Between(t.x,t.y,a,n)/2;t.setData({repeat:1,winPoints:e,currentWP:0}),scene.tweens.add({targets:t,x:a,y:n,duration:s,delay:i*framesToMs(2),onComplete:(e,t)=>{this.generateNextTween(t[0])}})})}destroyAllCardsAfterWinDance(){scene.groups.winDance.children.entries.forEach((e,t)=>{scene.groups.winDance.children.entries.length===t+1?e.setData({lastCard:!0}):e.setData({lastCard:!1}),scene.tweens.add({targets:e,alpha:0,delay:t*framesToMs(3),duration:500,onComplete:(e,t)=>{t[0].getData("lastCard")?vars.UI.buildWellDone():null,t[0].destroy()}})}),scene.children.getByName("skipWinDance")?scene.children.getByName("skipWinDance").destroy():null}destroyAllTweensAndCards(){scene.groups.winDance.children.entries.forEach(e=>{let t=scene.tweens.getTweensOf(e);t.length&&scene.tweens.getTweensOf(e)[0].remove(),e.destroy()})}generateNextTween(e){let t=e,a=t.getData("winPoints"),n=t.getData("currentWP");if(a&&a.length-1===n){let e=t.getData("repeat");0<e?(e--,t.setData({repeat:e,currentWP:-1}),this.generateNextTween(t)):(this.complete++,this.complete===this.totalCards&&this.throwCards())}else if(a){n++,t.setData({currentWP:n});let e=a[n][0],i=a[n][1],s=Phaser.Math.Distance.Between(t.x,t.y,e,i)/2;scene.tweens.add({targets:t,x:e,y:i,duration:s,onComplete:(e,t)=>{this.generateNextTween(t[0])}})}}getRandomWinDance(){let e=this.winDanceSets,t=Object.keys(e);if(!1===this.force){let e=getRandom(t),a=this.winDanceSets[e];return this.repeat=a.repeat?a.repeat:0,a.points}if(t.includes(this.force)){let e=this.winDanceSets[this.force];return this.repeat=e.repeat?e.repeat:0,e.points}else{let e=getRandom(t),a=this.winDanceSets[e];return this.repeat=a.repeat?a.repeat:0,a.points}}moveAllCardsToWD(){if(!vars.DEBUG)return!1;if(52===scene.groups.winDance.getLength())return!0;let e=57,t=scene.groups.winDance,a=[],n=[],i=scene.groups.cardCurrent;i.list.forEach(t=>{a.length||(a=[t.x,t.y]),t.setPosition(a[0],a[1]).setDepth(e),e--,n.push(t)}),i.removeAll();let s=scene.groups.cardsDealt;s.list.forEach(t=>{t.setPosition(a[0],a[1]).setDepth(e),e--,n.push(t)}),s.removeAll();let o=scene.groups.cardsLeft;o.list.forEach(t=>{t.setPosition(a[0],a[1]).setDepth(e),e--,n.push(t)}),o.removeAll(),t.addMultiple(n),scene.groups.winDance.children.entries.forEach(e=>{e.setCollideWorldBounds(!0,.75,.75).setDragX(30),e.disableInteractive()});let d=consts.canvas,r=scene.add.image(d.cX,d.cY,"whitePixel").setScale(d.width,d.height).setName("skipWinDance").setAlpha(.01).setDepth(255).setInteractive();return r.on("pointerup",()=>{vars.DEBUG?console.log(`Skipping winDance!`):null,scene.children.getByName("skipWinDance").destroy(),this.destroyAllTweensAndCards(),this.destroyAllCardsAfterWinDance()}),!0}throwCards(){return!!scene.groups.winDance.children.entries.length&&void(scene.groups.winDance.children.entries.forEach(e=>{let t=10*getRandom(-50,50),a=10*getRandom(-100,-50);e.body.setVelocity(t,a)}),scene.physics.resume(),scene.tweens.addCounter({from:0,to:1,duration:12e3,onComplete:()=>{vars.DEBUG?console.log(`Pausing physics. Fading out and killing all the cards in winGroup`):null,scene.physics.pause(),this.destroyAllCardsAfterWinDance()}}))}};